(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1565],{6129:(e,t,s)=>{Promise.resolve().then(s.bind(s,8831))},6463:(e,t,s)=>{"use strict";var r=s(1169);s.o(r,"redirect")&&s.d(t,{redirect:function(){return r.redirect}}),s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})},7616:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return n}});let r=s(2265);function n(e,t){let s=(0,r.useRef)(()=>{}),n=(0,r.useRef)(()=>{});return(0,r.useMemo)(()=>e&&t?r=>{null===r?(s.current(),n.current()):(s.current=a(e,r),n.current=a(t,r))}:e||t,[e,t])}function a(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let s=e(t);return"function"==typeof s?s:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},291:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouterContext",{enumerable:!0,get:function(){return r}});let r=s(9920)._(s(2265)).default.createContext(null)},8831:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>f});var r=s(7437),n=s(6425),a=s(1376),i=s(2363),l=s(3479),c=s(8497),o=s(2265),d=s(4962),u=s(6463),m=s(6648);let x=e=>{let{customer:t={},cartProducts:s=[],subtotal:a=0,createdAt:i}=e,{staffname:l}=t;return(0,r.jsxs)("div",{id:"receipt",className:"p-6 bg-white shadow-lg rounded-lg",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(m.default,{src:"/tealerinlogo.png",alt:"Company Logo",width:150,height:50,className:"mx-auto mb-4"}),(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:"TeaLerin"}),(0,r.jsx)("p",{children:"Contact: 0927-368-5006 | Block 10 Lot 23 Long Road"})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-700",children:"Staff Information"}),(0,r.jsxs)("p",{children:["Name: ",(0,r.jsx)("span",{className:"font-medium",children:l||"No Name"})]}),(0,r.jsxs)("p",{children:["Date: ",(0,r.jsx)("span",{className:"font-medium",children:i?new Date(i).toLocaleString():"N/A"})]})]}),(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h2",{className:"text-center font-bold",children:"Receipt"}),(0,r.jsx)("div",{className:"mt-4",children:s.length>0?s.map((e,t)=>(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsxs)("span",{children:[e.name," (x",e.quantity,")"]}),(0,r.jsxs)("span",{children:["₱",(0,n.B)(e).toFixed(2)]})]},t)):(0,r.jsx)("p",{children:"No products in the cart"})}),(0,r.jsx)("div",{className:"mt-4 text-right",children:(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Total:"})," ₱",a.toFixed(2)]})})]}),(0,r.jsxs)("div",{className:"mt-4 border-t pt-4 text-center text-gray-600",children:[(0,r.jsx)("p",{children:"Thank you for your purchase!"}),(0,r.jsx)("p",{children:"Visit us again!"}),(0,r.jsxs)("p",{children:["Please note that this is a non-refundable amount. For any assistance, please email",(0,r.jsx)("b",{children:" paolonavarrosa@gmail.com"}),"."]})]})]})};var h=s(998);function f(){let{cartProducts:e,removeCartProduct:t,setCartProducts:s,clearCart:m}=(0,o.useContext)(n.A),[f,p]=(0,o.useState)({}),{data:g}=(0,c.U)(),[j,v]=(0,o.useState)(!1),[b,y]=(0,o.useState)(""),[N,w]=(0,o.useState)(null),P=(0,u.useRouter)(),{status:C}=(0,h.useSession)();(0,o.useEffect)(()=>{window.location.href.includes("canceled=1")&&d.ZP.error("Payment failed \uD83D\uDE14")},[]),(0,o.useEffect)(()=>{if(g&&g.staffname){let{staffname:e}=g;p({staffname:e})}},[g]);let S=0;if(e)for(let t of e)S+=(0,n.B)(t);async function k(t){t.preventDefault();let s=new Promise((t,s)=>{fetch("/api/receipt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer:f,cartProducts:e,subtotal:S,change:N})}).then(async r=>{if(r.ok){let s=await r.json();await Promise.all(e.map(async e=>{let t=e.stock-e.quantity;await fetch("/api/menu-items",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:e._id,stock:t})})})),m(),t(s),d.ZP.success("Receipt saved and stock updated!")}else s(Error("Saving receipt failed"))}).catch(e=>{s(e)})});await d.ZP.promise(s,{loading:"Saving your receipt...",success:"Receipt saved and stock updated!",error:e=>e.message||"Something went wrong... Please try again later"})}function _(t,r){if(r<1)return;let n=e[t].stock;if(r>n){(0,d.ZP)("You can only purchase up to ".concat(n," of this product."),{icon:"⚠️",style:{background:"#fff",color:"#000"}});return}s(e=>{let s=[...e];return s[t].quantity=r,s})}return"unauthenticated"===C?(P.push("/login"),null):e&&0!==e.length?(0,r.jsxs)("section",{className:"mt-8 px-4",children:[(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)(i.Z,{mainHeader:"Your Cart"})}),e&&0!==e.length?(0,r.jsxs)("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,r.jsxs)("div",{children:[e.map((e,s)=>(0,r.jsxs)("div",{className:"mb-4 flex items-center justify-between border-b pb-4",children:[(0,r.jsx)(l.Z,{product:e,index:s,onRemove:t}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{className:"bg-gray-200 px-2 py-1 rounded-full hover:bg-gray-300",onClick:()=>_(s,e.quantity-1),children:"-"}),(0,r.jsx)("span",{className:"text-lg font-semibold",children:e.quantity}),(0,r.jsx)("button",{className:"bg-gray-200 px-2 py-1 rounded-full hover:bg-gray-300",onClick:()=>_(s,e.quantity+1),children:"+"})]})]},s)),(0,r.jsxs)("div",{className:"mt-6 flex justify-between items-center text-lg font-semibold",children:[(0,r.jsx)("span",{children:"Subtotal:"}),(0,r.jsxs)("span",{children:["₱",S.toFixed(2)]})]})]}),(0,r.jsxs)("div",{className:"bg-gray-100 p-6 rounded-lg shadow-md space-y-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold",children:"Checkout"}),(0,r.jsxs)("form",{onSubmit:k,children:[(0,r.jsx)(a.Z,{customerProps:f,setCustomerProp:function(e,t){p(s=>({...s,[e]:t}))}}),(0,r.jsx)("input",{type:"number",value:b,onChange:e=>{let t=e.target.value;if(y(t),t&&!isNaN(t)){let e=parseFloat(t)-S;w(e>=0?e:0)}else w(null)},placeholder:"Enter amount (e.g., 20 pesos)",className:"w-full p-2 border border-gray-300 rounded-md"}),null!==N&&(0,r.jsxs)("div",{className:"mt-2 text-lg font-semibold",children:[(0,r.jsx)("span",{children:"Change: "}),(0,r.jsxs)("span",{children:["₱",N.toFixed(2)]})]}),(0,r.jsx)("button",{type:"submit",className:"w-full mt-4 px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600",children:"Save Receipt"})]}),(0,r.jsx)("button",{onClick:()=>v(!0),className:"w-full px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600",children:"Print Receipt"})]})]}):(0,r.jsxs)("section",{className:"mt-8 text-center space-y-4",children:[(0,r.jsx)("p",{className:"text-gray-500 text-lg",children:"Your cart is currently empty \uD83D\uDE14"}),(0,r.jsx)("button",{onClick:()=>P.push("/menu"),className:"px-6 py-2 bg-green-500 text-white rounded-md hover:bg-green-600",children:"Browse Menu"})]}),j&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-lg w-full",children:[(0,r.jsx)(x,{customer:f,cartProducts:e,subtotal:S,createdAt:new Date().toLocaleString()}),(0,r.jsxs)("div",{className:"mt-4 flex justify-between",children:[(0,r.jsx)("button",{onClick:()=>{window.print(),v(!1)},className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600",children:"Print"}),(0,r.jsx)("button",{onClick:()=>v(!1),className:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600",children:"Close"})]})]})})]}):(0,r.jsxs)("section",{className:"mt-8 text-center",children:[(0,r.jsx)(i.Z,{mainHeader:"Cart"}),(0,r.jsx)("p",{className:"mt-4",children:"Cart is empty \uD83D\uDE14"})]})}},6425:(e,t,s)=>{"use strict";s.d(t,{A:()=>l,AppProvider:()=>o,B:()=>c});var r=s(7437),n=s(998),a=s(2265),i=s(4962);let l=(0,a.createContext)({});function c(e){var t;let s=e.basePrice||0;if((null===(t=e.size)||void 0===t?void 0:t.price)&&(s+=e.size.price),Array.isArray(e.extras))for(let t of e.extras)s+=t.price||0;return s*(e.quantity||1)}function o(e){let{children:t}=e,[s,c]=(0,a.useState)([]),o=window.localStorage;function d(e){o&&o.setItem("cart",JSON.stringify(e))}return(0,a.useEffect)(()=>{if(o&&o.getItem("cart"))try{let e=JSON.parse(o.getItem("cart"));Array.isArray(e)&&c(e)}catch(e){console.error("Failed to parse cart from localStorage:",e),o.removeItem("cart")}},[o]),(0,r.jsx)(n.SessionProvider,{children:(0,r.jsx)(l.Provider,{value:{cartProducts:s,setCartProducts:c,addToCart:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(!((e.stock||0)>0)){i.ZP.error("Cannot add item to cart");return}c(n=>{let a=n.findIndex(r=>{var n;return r._id===e._id&&(null===(n=r.size)||void 0===n?void 0:n._id)===(null==t?void 0:t._id)&&JSON.stringify(r.extras)===JSON.stringify(s)});if(-1!==a){let e=[...n];return e[a].quantity+=r,d(e),e}{let a=[...n,{...e,size:t,extras:s,quantity:r}];return d(a),a}})},removeCartProduct:function(e){c(t=>{let s=t.filter((t,s)=>s!==e);return d(s),s}),i.ZP.success("Product removed")},clearCart:function(){c([]),d([])}},children:t})})}},8497:(e,t,s)=>{"use strict";s.d(t,{U:()=>n});var r=s(2265);function n(){let[e,t]=(0,r.useState)(!1),[s,n]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{n(!0),fetch("/api/profile").then(e=>{e.json().then(e=>{t(e),n(!1)})})},[]),{loading:s,data:e}}},3550:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});var r=s(7437);function n(e){let{className:t="w-6 h-6"}=e;return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:t,children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})}},1376:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});var r=s(7437);function n(e){let{customerProps:t,setCustomerProp:s}=e;return(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{children:"Name"}),(0,r.jsx)("input",{type:"text",value:t.staffname||"",onChange:e=>s("staffname",e.target.value),className:"border p-2 rounded w-full",placeholder:"Your Name"})]})}},2363:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});var r=s(7437);function n(e){let{subHeader:t,mainHeader:s}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{className:"uppercase text-white-500 font-semibold leading-4",children:t}),(0,r.jsx)("h2",{className:"text-green-500 font-bold text-4xl italic",children:s})]})}},3479:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var r=s(7437),n=s(6425),a=s(3550),i=s(6648);function l(e){var t;let{product:s,onRemove:l,index:c}=e,o=e=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2}).format(e);return(0,r.jsxs)("div",{className:"flex items-center gap-4 border-b py-4",children:[(0,r.jsx)("div",{className:"w-24",children:(0,r.jsx)(i.default,{width:240,height:240,src:s.image,alt:"productssimage"})}),(0,r.jsxs)("div",{className:"grow",children:[(0,r.jsx)("h3",{className:"font-semibold",children:s.name}),s.size&&(0,r.jsxs)("div",{className:"text-sm",children:["Size: ",(0,r.jsx)("span",{children:s.size.name})]}),(null===(t=s.extras)||void 0===t?void 0:t.length)>0&&(0,r.jsx)("div",{className:"text-sm text-gray-500",children:s.extras.map(e=>(0,r.jsxs)("div",{children:[e.name," ",o(e.price)]},e.name))})]}),(0,r.jsx)("div",{className:"text-lg font-semibold",children:o((0,n.B)(s))}),!!l&&(0,r.jsx)("div",{className:"ml-2",children:(0,r.jsx)("button",{type:"button",onClick:()=>l(c),className:"p-2",children:(0,r.jsx)(a.Z,{})})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[4962,6648,998,7130,6215,1744],()=>t(6129)),_N_E=e.O()}]);