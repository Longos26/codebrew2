(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1693],{67:()=>{},2061:()=>{},1822:(e,t,s)=>{Promise.resolve().then(s.bind(s,3459))},152:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var a=s(9018),r=s(7437);let l=(0,a.Z)((0,r.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download")},3459:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var a=s(7437),r=s(2546),l=s(2265),n=s(6463),i=s(4962),o=s(8497),c=s(7214),d=s(7800),h=s(551),u=s(152),x=s(468);let m=()=>{let[e,t]=(0,l.useState)([]),[s,m]=(0,l.useState)(!0),[g,p]=(0,l.useState)(!1),[f,j]=(0,l.useState)(null),{loading:N,data:v}=(0,o.U)(),[b,w]=(0,l.useState)(!1),[y,P]=(0,l.useState)(0),[_,E]=(0,l.useState)(5);(0,n.useRouter)();let k=async()=>{m(!0);try{let e=await fetch("/api/receipt",{cache:"no-store"});if(!e.ok)throw Error("Failed to fetch receipts");let s=await e.json();t(s)}catch(e){console.error("Error fetching receipts:",e),i.ZP.error("Failed to load receipts")}finally{m(!1)}};(0,l.useEffect)(()=>{k();let e=setInterval(k,3e4);return()=>clearInterval(e)},[]);let S=e=>{j(e),w(!0)},Z=async e=>{p(!0);try{if(!(await fetch("/api/receipt?id=".concat(e),{method:"DELETE"})).ok)throw Error("Failed to delete receipt");t(t=>t.filter(t=>t._id!==e)),i.ZP.success("Receipt deleted successfully")}catch(e){console.error("Error deleting receipt:",e),i.ZP.error(e.message)}finally{p(!1)}};return N?"Loading user info...":(null==v?void 0:v.admin)?(0,a.jsxs)("section",{className:"mt-8 max-w-4xl mx-auto p-6 bg-white shadow-lg rounded-lg",children:[(0,a.jsx)(r.Z,{isAdmin:!0}),(0,a.jsx)("div",{className:"flex justify-between items-center mt-8",children:(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Receipts"})}),(0,a.jsxs)("button",{onClick:()=>{if(0===e.length){i.ZP.error("No data available for download.");return}let t=d.P6.json_to_sheet(e.map(e=>{var t;return{"Staff Name":(null===(t=e.customer)||void 0===t?void 0:t.staffname)||"N/A",Subtotal:"₱".concat(e.subtotal.toFixed(2)),"Created At":new Date(e.createdAt).toLocaleString("en-PH")}})),s=d.P6.book_new();d.P6.book_append_sheet(s,t,"Receipts"),d.NC(s,"receipts.xlsx")},className:" bg-green-500 text-white rounded-md hover:bg-green-600",children:[(0,a.jsx)(u.Z,{})," Download Excel"]}),(0,a.jsx)("div",{className:"mt-8",children:s?(0,a.jsx)("div",{className:"flex justify-center items-center",children:(0,a.jsx)(x.Z,{})}):e.length>0?e.slice(y*_,y*_+_).map(e=>(0,a.jsxs)("div",{className:"bg-gray-100 rounded-lg mb-2 p-4 flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 grow",children:[(0,a.jsx)("div",{className:"text-gray-900",children:e.customer?(0,a.jsx)("span",{children:e.customer.staffname}):(0,a.jsx)("span",{className:"italic",children:"No Name"})}),(0,a.jsxs)("span",{className:"text-gray-500",children:["₱",e.subtotal.toFixed(2)]}),(0,a.jsx)("span",{className:"text-gray-500 text-sm",children:new Date(e.createdAt).toLocaleString("en-PH")})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>S(e),className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600",children:"View"}),(0,a.jsx)("button",{onClick:()=>Z(e._id),className:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600",disabled:g,children:g?"Deleting...":"Delete"})]})]},e._id)):(0,a.jsx)("p",{className:"text-gray-500",children:"No receipts found."})}),(0,a.jsx)(c.Z,{isOpen:b,onClose:()=>w(!1),receipt:f}),(0,a.jsx)(h.Z,{component:"div",count:e.length,page:y,onPageChange:(e,t)=>{P(t)},rowsPerPage:_,onRowsPerPageChange:e=>{E(parseInt(e.target.value,10)),P(0)}})]}):"Not an admin"}}},e=>{var t=t=>e(e.s=t);e.O(0,[1425,7138,4962,6648,998,5060,551,4564,7130,6215,1744],()=>t(1822)),_N_E=e.O()}]);